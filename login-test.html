<!-- login-test.html -->
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Prueba Login Backend</title>
  </head>
  <body>
    <h1>Prueba Login Backend</h1>
    <input
      type="text"
      id="token"
      placeholder="Pega aquÃ­ tu token de Firebase"
      size="80"
    />
    <button onclick="login()">Login</button>
    <button onclick="loginWithGoogle()">Login con Google</button>
    <pre id="result"></pre>
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script>
      // TODO: Reemplaza estos valores con los de tu proyecto Firebase
      const firebaseConfig = {
        apiKey: 'AIzaSyBDIAZ1_Wb_HmHzlDUqT0BepqKT9qqI2Dg',
        authDomain: 'clinic-hub-e56fd.firebaseapp.com',
        projectId: 'clinic-hub-e56fd',
      };
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();

      async function login() {
        const token = document.getElementById('token').value;
        const result = document.getElementById('result');
        result.textContent = 'Enviando...';
        try {
          const response = await fetch(
            'http://localhost:9999/api/v1/auth/login',
            {
              method: 'POST',
              headers: {
                Authorization: `Bearer ${token}`,
                'Content-Type': 'application/json',
              },
            },
          );
          const data = await response.json();
          result.textContent = JSON.stringify(data, null, 2);
        } catch (err) {
          result.textContent = 'Error: ' + err;
        }
      }

      async function loginWithGoogle() {
        const provider = new firebase.auth.GoogleAuthProvider();
        const resultElem = document.getElementById('result');
        const tokenInput = document.getElementById('token');
        resultElem.textContent = 'Abriendo popup de Google...';
        try {
          const result = await auth.signInWithPopup(provider);
          const token = await result.user.getIdToken();
          tokenInput.value = token; // Mostrar el token en el input
          resultElem.textContent = 'Enviando token al backend...';
          const response = await fetch('http://localhost:9999/auth/login', {
            method: 'POST',
            headers: {
              Authorization: `Bearer ${token}`,
              'Content-Type': 'application/json',
            },
          });
          const data = await response.json();
          resultElem.textContent = JSON.stringify(data, null, 2);
        } catch (err) {
          resultElem.textContent = 'Error: ' + err;
        }
      }
    </script>
  </body>
</html>
